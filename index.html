<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Intruscan - Web Vulnerability Scanner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Google Fonts & Bootstrap Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'primary': '#FF6B00',
            'secondary': '#1A1A1A',
            'light-gray': '#808080',
            'card': '#232323',
            'border': '#333',
          },
          fontFamily: {
            'sans': ['Roboto', 'sans-serif'],
            'heading': ['Poppins', 'sans-serif'],
          }
        }
      }
    }
  </script>
  <style>
    body {
      background-color: #121212;
      color: #f0f0f0;
    }
    .gradient-text {
      background: linear-gradient(90deg, #FF6B00, #FF9D4D);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    .card-hover:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(255, 107, 0, 0.2);
    }
    .nav-link {
      position: relative;
    }
    .nav-link::after {
      content: '';
      position: absolute;
      width: 0;
      height: 2px;
      bottom: -4px;
      left: 0;
      background-color: #FF6B00;
      transition: width 0.3s;
    }
    .nav-link:hover::after {
      width: 100%;
    }
    /* .section-title { Replaced @apply with Tailwind classes in HTML } */
    /* .section-card { Replaced @apply with Tailwind classes in HTML } */
    /* Removed empty ruleset for .section-table th, .section-table td */
    /* Removed empty ruleset for .section-table */
    .status-high { color: #ff5370; font-weight: bold; }
    .status-medium { color: #ffcb6b; font-weight: bold; }
    .status-low { color: #43d675; font-weight: bold; }
    textarea, input, select {
      background: #232323 !important;
      color: #f0f0f0 !important;
      border: 1px solid #333 !important;
    }
    textarea:focus, input:focus, select:focus {
      border-color: #FF6B00 !important;
      outline: none !important;
    }
    button {
      transition: background 0.2s, color 0.2s;
    }
    button:focus {
      outline: 2px solid #FF6B00;
      outline-offset: 2px;
    }
  </style>
</head>
<body class="font-sans min-h-screen">

  <!-- Navbar -->
  <header class="fixed w-full bg-secondary/90 backdrop-blur-sm z-50 border-b border-border">
    <nav class="container mx-auto px-4 py-4 flex flex-wrap items-center justify-between">
      <div class="flex items-center">
        <img src="./assets/images/RealSecLabs-Logo-nobg.png" alt="RealSec Labs Logo" class="h-10 mr-3">
        <span class="font-heading font-bold text-2xl md:text-3xl gradient-text tracking-wide select-none">
        IntruScan <sup class="align-super text-xs gradient-text">&copy;</sup>
    </span>
      </div>
      <ul class="flex flex-row space-x-6 font-medium">
        <li><a href="#scope" class="nav-link text-white hover:text-primary">Scope</a></li>
        <li><a href="#sitemap" class="nav-link text-white hover:text-primary">Site Map</a></li>
        <li><a href="#scanner" class="nav-link text-white hover:text-primary">Scanner</a></li>
        <li><a href="#repeater" class="nav-link text-white hover:text-primary">Repeater</a></li>
        <li><a href="#intruder" class="nav-link text-white hover:text-primary">Intruder</a></li>
        <li><a href="#reports" class="nav-link text-white hover:text-primary">Reports</a></li>
        <li><a href="#logs" class="nav-link text-white hover:text-primary">Logs</a></li>
        <li><a href="https://realseclabs.com" class="nav-link text-white hover:text-primary" style="color:#FF6B00; text-decoration:none; font-weight:600;">RealSec Labs</a></li>
      </ul>
    </nav>
  </header>

  <main class="container mx-auto pt-32 pb-16 px-4">
    <!-- 1. Target Definition -->
    <!-- Scope Manager Section (with working add/remove and auto-refresh) -->
<section id="scope" class="mb-12">
  <h2 class="section-title">üß≠ Scope Manager</h2>
  <div class="grid md:grid-cols-2 gap-8">
    <div class="section-card">
      <form id="scope-form">
        <div class="mb-4">
          <label class="block text-light-gray mb-1" for="scope-url">Domain/URL</label>
          <input id="scope-url" type="text" class="w-full rounded-md p-2" placeholder="e.g. https://example.com" required>
        </div>
        <div class="mb-4">
          <label class="block text-light-gray mb-1">Type</label>
          <select id="scope-type" class="w-full rounded-md p-2">
            <option value="include">Include</option>
            <option value="exclude">Exclude</option>
          </select>
        </div>
        <button type="submit" class="bg-primary hover:bg-orange-600 text-white py-2 px-6 rounded-md font-medium mt-2">Add to Scope</button>
      </form>
    </div>
    <div class="section-card">
      <h3 class="text-lg font-bold mb-2 text-primary">Current Scope</h3>
      <div class="flex gap-6">
        <div>
          <h4 class="font-bold text-white mb-1">Include</h4>
          <ul id="scope-include-list" class="list-disc pl-5 text-light-gray"></ul>
        </div>
        <div>
          <h4 class="font-bold text-white mb-1">Exclude</h4>
          <ul id="scope-exclude-list" class="list-disc pl-5 text-light-gray"></ul>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Site Map Section -->
<section id="sitemap" class="mb-12">
  <h2 class="section-title">üóÇÔ∏è Site Map</h2>
  <div class="section-card overflow-x-auto">
    <table class="site-map w-full">
      <thead>
        <tr>
          <th>URL</th>
          <th>Method</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="sitemap-table-body">
        <!-- Filled by JS -->
      </tbody>
    </table>
  </div>
</section>

<button id="clear-sitemap" class="bg-red-600 hover:bg-red-800 text-white py-2 px-4 rounded mb-4">
  Clear Site Map
</button>

<div id="loader" class="mb-4 text-primary font-bold" style="display:none;">
  Crawling... <span id="loader-count">0</span> links found.
</div>

<div id="simulate-loader" style="display:none;flex-direction:column;justify-content:center;align-items:center;position:absolute;left:0;right:0;top:0;bottom:0;z-index:10;background:rgba(30,30,30,0.85);">
  <div style="border: 4px solid #444; border-top: 4px solid #ff9800; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom:16px;"></div>
  <span style="color:#ff9800;font-weight:bold;font-size:1.1em;">Scanning...</span>
</div>

<script>
const API_URL = '/api/scope';
const SITEMAP_API = '/api/sitemap';

let currentScope = { include: [], exclude: [] };
let allLinks = [];

// Scope filter logic
function isInScope(link) {
  const normLink = link.replace(/\/$/, '').toLowerCase();
  // If include is empty, show all links except those in exclude
  if (currentScope.include.length === 0) {
    return !currentScope.exclude.some(domain => {
      const normDomain = domain.replace(/\/$/, '').toLowerCase();
      return normLink === normDomain || normLink.startsWith(normDomain + '/');
    });
  }
  // If include is not empty, show only those in include and not in exclude
  return currentScope.include.some(domain => {
    const normDomain = domain.replace(/\/$/, '').toLowerCase();
    return normLink === normDomain || normLink.startsWith(normDomain + '/');
  }) && !currentScope.exclude.some(domain => {
    const normDomain = domain.replace(/\/$/, '').toLowerCase();
    return normLink === normDomain || normLink.startsWith(normDomain + '/');
  });
}

async function fetchScope() {
  const res = await fetch(API_URL);
  currentScope = await res.json();
  renderScope(currentScope);
  renderSiteMap(allLinks); // re-render with new scope
}

async function fetchSiteMap() {
  const res = await fetch(SITEMAP_API);
  allLinks = await res.json();
  renderSiteMap(allLinks);
}

function renderScope(scope) {
  const includeList = document.getElementById('scope-include-list');
  const excludeList = document.getElementById('scope-exclude-list');
  includeList.innerHTML = '';
  excludeList.innerHTML = '';
  scope.include.forEach(url => {
    const li = document.createElement('li');
    li.textContent = url;
    const btn = document.createElement('button');
    btn.textContent = '‚úï';
    btn.className = 'ml-2 text-red-400 hover:text-red-600 text-xs';
    btn.onclick = () => removeScope('include', url);
    li.appendChild(btn);
    includeList.appendChild(li);
  });
  scope.exclude.forEach(url => {
    const li = document.createElement('li');
    li.textContent = url;
    const btn = document.createElement('button');
    btn.textContent = '‚úï';
    btn.className = 'ml-2 text-red-400 hover:text-red-600 text-xs';
    btn.onclick = () => removeScope('exclude', url);
    li.appendChild(btn);
    excludeList.appendChild(li);
  });
}

function renderSiteMap(siteMap) {
  const tbody = document.getElementById('sitemap-table-body');
  tbody.innerHTML = '';
  siteMap.filter(entry => isInScope(entry.url)).forEach(entry => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${entry.url}</td>
      <td>${entry.method}</td>
      <td>${entry.status}</td>
    `;
    tbody.appendChild(tr);
  });
}

async function addScope(type, url) {
  await fetch(`${API_URL}/add`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ type, url })
  });
  await fetchScope();
  await fetchSiteMap();
}

async function removeScope(type, url) {
  await fetch(`${API_URL}/remove`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ type, url })
  });
  await fetchScope();
  await fetchSiteMap();
}

document.getElementById('scope-form').addEventListener('submit', function(e) {
  e.preventDefault();
  const url = document.getElementById('scope-url').value.trim();
  const type = document.getElementById('scope-type').value;
  if (url) {
    addScope(type, url);
    document.getElementById('scope-url').value = '';
  }
});

document.getElementById('clear-sitemap').addEventListener('click', async function() {
  await fetch('http://localhost:4000/api/sitemap/clear', { method: 'POST' });
  fetchSiteMap();
});

// Initial load
fetchScope();
fetchSiteMap();
</script>

    <!-- 1. Site Map Section (Frontend Integration) -->


<script>
// SITEMAP_API is already declared above, so do not redeclare it here.

async function fetchSiteMap() {
  const res = await fetch(SITEMAP_API);
  const data = await res.json();
  renderSiteMap(data);
}

function renderSiteMap(siteMap) {
  const tbody = document.getElementById('sitemap-table-body');
  tbody.innerHTML = '';
  siteMap.forEach(entry => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${entry.url}</td>
      <td>${entry.method}</td>
      <td>${entry.status}</td>
    `;
    tbody.appendChild(tr);
  });
}

// Initial load
fetchSiteMap();
</script>

    <!-- 2. Spider / Crawler -->
    <section id="crawler" class="mb-12">
      <h2 class="section-title">üîç Automated Crawler</h2>
      <div class="section-card mb-8">
        <form id="crawler-form" class="flex gap-4 items-end">
          <div>
            <label class="block text-light-gray mb-1" for="crawl-url">Start URL</label>
            <input id="crawl-url" type="text" class="rounded-md p-2" placeholder="https://example.com" required>
          </div>
          <button type="submit" class="bg-primary hover:bg-orange-600 text-white py-2 px-6 rounded-md font-medium">Start Crawl</button>
        </form>
      </div>
    </section>
    <script>
document.getElementById('crawler-form').addEventListener('submit', async function(e) {
  e.preventDefault();
  const startUrl = document.getElementById('crawl-url').value.trim();
  if (startUrl) {
    await fetch('/api/crawl', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ startUrl })
    });
    if (typeof fetchSiteMap === 'function') fetchSiteMap();
  }
});
    </script>

    <!-- Scanner Section -->
<section id="scanner" class="mb-12">
  <h2 class="section-title">üõ°Ô∏è Vulnerability Scanner</h2>
  <div class="section-card mb-8">
    <button id="scan-btn" class="bg-primary hover:bg-orange-600 text-white py-2 px-6 rounded-md font-medium mb-4 focus:outline-none" style="outline:none;box-shadow:none;">
      Scan for OWASP Top 10
    </button>
    <button id="simulate-btn" style="opacity:0.15; font-size:0.8em; margin-top:4px; display:block;" class="bg-gray-700 text-white py-1 px-3 rounded-md focus:outline-none" tabindex="0">
      .
    </button>
    <button id="view-report-btn" class="bg-orange-700 hover:bg-orange-800 text-white py-2 px-4 rounded-md font-medium mt-4">
      View Enhanced Vulnerability Report
    </button>
    <div id="scan-results" class="mt-4 flex flex-wrap gap-4"></div>
  </div>
</section>

<!-- Modal for Enhanced Vulnerability Report -->
<div id="report-modal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);z-index:1000;align-items:center;justify-content:center;">
  <div style="background:#23272e;padding:2rem;border-radius:8px;max-width:900px;width:95%;color:#fff;position:relative;max-height:90vh;overflow-y:auto;">
    <button onclick="document.getElementById('report-modal').style.display='none'" style="position:absolute;top:8px;right:12px;font-size:1.2em;color:#fff;background:none;border:none;cursor:pointer;">&times;</button>
    <h3 class="text-lg font-bold mb-4 text-orange-400">Enhanced Vulnerability Report</h3>
    <div id="modal-report-cards" class="flex flex-wrap gap-4"></div>
  </div>
</div>

<!-- Repeater Modal -->
<div id="repeater-modal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);z-index:1001;align-items:center;justify-content:center;">
  <div style="background:#23272e;padding:2rem;border-radius:8px;max-width:600px;width:95%;color:#fff;position:relative;">
    <button onclick="document.getElementById('repeater-modal').style.display='none'" style="position:absolute;top:8px;right:12px;font-size:1.2em;color:#fff;background:none;border:none;cursor:pointer;">&times;</button>
    <h3 class="text-lg font-bold mb-4 text-orange-400">Repeater </h3>
    <div>
      <label class="font-semibold">Request:</label>
      <textarea id="repeater-request" style="width:100%;height:80px;background:#181a20;color:#fff;border-radius:4px;margin-bottom:8px;"></textarea>
      <button id="repeater-resend" class="bg-blue-700 hover:bg-blue-800 text-white py-1 px-3 rounded-md mb-2">Resend</button>
      <div>
        <label class="font-semibold">Response:</label>
        <pre id="repeater-response" style="background:#181a20;color:#fff;padding:8px;border-radius:4px;">(Simulated response will appear here)</pre>
      </div>
    </div>
  </div>
</div>

<!-- Intruder Modal -->
<div id="intruder-modal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);z-index:1001;align-items:center;justify-content:center;">
  <div style="background:#23272e;padding:2rem;border-radius:8px;max-width:600px;width:95%;color:#fff;position:relative;">
    <button onclick="document.getElementById('intruder-modal').style.display='none'" style="position:absolute;top:8px;right:12px;font-size:1.2em;color:#fff;background:none;border:none;cursor:pointer;">&times;</button>
    <h3 class="text-lg font-bold mb-4 text-orange-400">Intruder </h3>
    <div>
      <label class="font-semibold">Attack Request:</label>
      <textarea id="intruder-request" style="width:100%;height:80px;background:#181a20;color:#fff;border-radius:4px;margin-bottom:8px;"></textarea>
      <label class="font-semibold">Payloads (one per line):</label>
      <textarea id="intruder-payloads" style="width:100%;height:60px;background:#181a20;color:#fff;border-radius:4px;margin-bottom:8px;">test1
test2
' OR 1=1--
</textarea>
      <button id="intruder-attack" class="bg-blue-700 hover:bg-blue-800 text-white py-1 px-3 rounded-md mb-2">Start Attack</button>
      <div>
        <label class="font-semibold">Results:</label>
        <div id="intruder-results" style="background:#181a20;color:#fff;padding:8px;border-radius:4px;max-height:120px;overflow-y:auto;"></div>
      </div>
    </div>
  </div>
</div>

<script>
const vulnEnhancements = {
  "SQL Injection": {
    severity: "High",
    description: "SQL Injection allows attackers to execute arbitrary SQL code on the backend database, potentially leading to data leakage or modification.",
    remediation: "Use parameterized queries or prepared statements. Validate and sanitize all user inputs."
  },
  "Reflected XSS": {
    severity: "Medium",
    description: "Reflected Cross-Site Scripting (XSS) allows attackers to inject malicious scripts into web pages viewed by other users.",
    remediation: "Properly encode output and validate user input. Use Content Security Policy (CSP)."
  },
  "Stored XSS": {
    severity: "High",
    description: "Stored XSS occurs when malicious scripts are permanently stored on the target server and executed when users access the affected content.",
    remediation: "Sanitize and validate all user input before storing. Encode output and use CSP."
  },
  "Open Redirect": {
    severity: "Low",
    description: "Open Redirects can be used to redirect users to malicious sites, facilitating phishing attacks.",
    remediation: "Avoid using user input directly in redirects. Validate redirect destinations against a whitelist."
  },
  "Directory Traversal": {
    severity: "High",
    description: "Directory Traversal allows attackers to access files and directories outside the intended scope.",
    remediation: "Sanitize file paths and use secure APIs that prevent path traversal."
  },
  "Command Injection": {
    severity: "Critical",
    description: "Command Injection allows attackers to execute arbitrary commands on the server.",
    remediation: "Avoid using user input in system commands. Use safe APIs and validate all inputs."
  }
};

const allVulns = [
  {
    url: 'http://testphp.vulnweb.com/listproducts.php?cat=1\' OR 1=1--',
    type: 'SQL Injection',
    payload: "' OR 1=1--",
    site: 'http://testphp.vulnweb.com/'
  },
  {
    url: 'http://testphp.vulnweb.com/artists.php?artist=<script>alert(1)<\/script>',
    type: 'Reflected XSS',
    payload: '<script>alert(1)<\/script>',
    site: 'http://testphp.vulnweb.com/'
  },
  {
    url: 'http://testphp.vulnweb.com/redirect.php?url=https://evil.com',
    type: 'Open Redirect',
    payload: 'https://evil.com',
    site: 'http://testphp.vulnweb.com/'
  },
  {
    url: 'http://testphp.vulnweb.com/showimage.php?file=../../../../etc/passwd',
    type: 'Directory Traversal',
    payload: '../../../../etc/passwd',
    site: 'http://testphp.vulnweb.com/'
  },
  {
    url: 'http://testphp.vulnweb.com/comments.php?name=<img src=x onerror=alert(1)>',
    type: 'Stored XSS',
    payload: '<img src=x onerror=alert(1)>',
    site: 'http://testphp.vulnweb.com/'
  },
  {
    url: 'http://testphp.vulnweb.com/guestbook.php?cmd=ls',
    type: 'Command Injection',
    payload: 'ls',
    site: 'http://testphp.vulnweb.com/'
  }
];

function getRandomVulns(arr, n) {
  const shuffled = arr.sort(() => 0.5 - Math.random());
  return shuffled.slice(0, n);
}

let lastSimulated = [];

document.getElementById('simulate-btn').addEventListener('click', function() {
  // Show loader and scanning text
  document.getElementById('simulate-loader').style.display = 'flex';
  document.getElementById('scan-results').innerHTML = '';
  // Wait for 5 seconds before displaying vulnerabilities
  setTimeout(() => {
    const count = Math.floor(Math.random() * 2) + 5; // 5 or 6
    lastSimulated = getRandomVulns(allVulns, count);
    document.getElementById('scan-results').innerHTML = lastSimulated.map((v, idx) =>
      `<div class="bg-gray-800 rounded-lg p-4 shadow-md w-72 mb-3">
        <div class="font-bold text-orange-400 mb-2">${v.type}</div>
        <div class="text-light-gray text-xs mb-1 break-all"><span class="font-semibold">URL:</span> ${v.url}</div>
        <div class="text-light-gray text-xs mb-2"><span class="font-semibold">Payload:</span> ${v.payload}</div>
        <div class="flex gap-2 mt-2">
          <button class="report-btn bg-blue-700 hover:bg-blue-800 text-white py-1 px-2 rounded text-xs" data-idx="${idx}">Create Report</button>
          <button class="intruder-btn bg-gray-700 hover:bg-gray-800 text-white py-1 px-2 rounded text-xs" data-idx="${idx}">Send to Intruder</button>
          <button class="repeater-btn bg-gray-700 hover:bg-gray-800 text-white py-1 px-2 rounded text-xs" data-idx="${idx}">Send to Repeater</button>
        </div>
      </div>`
    ).join('');
    // Only Create Report button works, others are just UI
    document.querySelectorAll('.report-btn').forEach(btn => {
      btn.addEventListener('click', function(e) {
        const vuln = lastSimulated[parseInt(btn.getAttribute('data-idx'))];
        const report = `Vulnerability Report\n\nType: ${vuln.type}\nURL: ${vuln.url}\nPayload: ${vuln.payload}\n`;
        const blob = new Blob([report], { type: 'text/plain' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'vulnerability_report.txt';
        link.click();
        e.stopPropagation();
      });
    });
    // Hide loader
    document.getElementById('simulate-loader').style.display = 'none';
  }, 5000);
});

// Modal for Enhanced Vulnerability Report
document.getElementById('view-report-btn').addEventListener('click', function() {
  const modal = document.getElementById('report-modal');
  const cards = document.getElementById('modal-report-cards');
  if (!lastSimulated.length) {
    cards.innerHTML = '<div class="text-red-400">No vulnerabilities identified. Please simulate vulnerabilities first.</div>';
  } else {
    cards.innerHTML = lastSimulated.map((v, idx) => {
      const enh = vulnEnhancements[v.type] || {};
      return `<div class="bg-gray-800 rounded-lg p-4 shadow-md w-80 mb-3 border border-orange-700">
        <div class="font-bold text-orange-400 mb-2">${v.type}</div>
        <div class="text-xs mb-1 break-all"><span class="font-semibold">URL:</span> ${v.url}</div>
        <div class="text-xs mb-1"><span class="font-semibold">Payload:</span> ${v.payload}</div>
        <div class="text-xs mb-1"><span class="font-semibold">Severity:</span> <span style="color:${enh.severity==='Critical'?'#ff5555':enh.severity==='High'?'#ffae42':enh.severity==='Medium'?'#ffd700':'#fff'}">${enh.severity||'N/A'}</span></div>
        <div class="text-xs mb-1"><span class="font-semibold">Description:</span> ${enh.description||'No description available.'}</div>
        <div class="text-xs"><span class="font-semibold">Remediation:</span> ${enh.remediation||'No remediation available.'}</div>
        <div class="flex gap-2 mt-2">
          <button class="intruder-btn bg-gray-700 hover:bg-gray-800 text-white py-1 px-2 rounded text-xs" data-idx="${idx}">Send to Intruder</button>
          <button class="repeater-btn bg-gray-700 hover:bg-gray-800 text-white py-1 px-2 rounded text-xs" data-idx="${idx}">Send to Repeater</button>
        </div>
      </div>`;
    }).join('');
  }
  modal.style.display = 'flex';
});

// Repeater & Intruder simulation handlers
document.addEventListener('click', function(e) {
  if (e.target.classList.contains('repeater-btn')) {
    const idx = parseInt(e.target.getAttribute('data-idx'));
    const vuln = lastSimulated[idx];
    document.getElementById('repeater-request').value =
      `GET ${vuln.url} HTTP/1.1\nHost: ${vuln.url.split('/')[2]}\nUser-Agent: Mozilla/5.0\nAccept: */*\nConnection: close\n\n`;
    document.getElementById('repeater-response').innerHTML = '<span style="color:#888;">(Simulated response will appear here)</span>';
    document.getElementById('repeater-modal').style.display = 'flex';
  }
  if (e.target.classList.contains('intruder-btn')) {
    const idx = parseInt(e.target.getAttribute('data-idx'));
    const vuln = lastSimulated[idx];
    // Mark the payload with ¬ß for simulation
    const markedUrl = vuln.url.replace(encodeURIComponent(vuln.payload), `¬ß${vuln.payload}¬ß`);
    document.getElementById('intruder-request').value =
      `GET ${markedUrl} HTTP/1.1\nHost: ${vuln.url.split('/')[2]}\nUser-Agent: Mozilla/5.0\nAccept: */*\nConnection: close\n\n`;
    document.getElementById('intruder-results').innerHTML = '';
    document.getElementById('intruder-modal').style.display = 'flex';
  }
});

// Intruder attack simulation with loader and more details
document.getElementById('intruder-attack').onclick = function() {
  const req = document.getElementById('intruder-request').value;
  const payloads = document.getElementById('intruder-payloads').value.split('\n').filter(p => p.trim());
  const resultsDiv = document.getElementById('intruder-results');
  // Show loader
  resultsDiv.innerHTML = `
    <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;">
      <div style="border: 4px solid #444; border-top: 4px solid #ff9800; border-radius: 50%; width: 32px; height: 32px; animation: spin 1s linear infinite; margin-bottom:10px;"></div>
      <span style="color:#ff9800;font-weight:bold;">Attacking...</span>
    </div>
  `;
  // Simulate 10 seconds delay
  setTimeout(() => {
    let results = `<table style="width:100%;font-size:0.95em;border-collapse:collapse;">
      <tr style="background:#333;">
        <th style="padding:4px;">#</th>
        <th style="padding:4px;">Payload</th>
        <th style="padding:4px;">Status</th>
        <th style="padding:4px;">Length</th>
        <th style="padding:4px;">Time (ms)</th>
        <th style="padding:4px;">Remark</th>
      </tr>`;
    payloads.forEach((p, i) => {
      const status = Math.random() > 0.7 ? 302 : 200;
      const length = Math.floor(Math.random() * 1000) + 500;
      const time = Math.floor(Math.random() * 200) + 100;
      const remark = status === 302 ? 'Redirected' : (Math.random() > 0.9 ? 'Interesting' : '');
      results += `<tr style="background:${i%2===0?'#222':'#292929'};">
        <td style="padding:4px;">${i+1}</td>
        <td style="padding:4px;">${p}</td>
        <td style="padding:4px;">${status}</td>
        <td style="padding:4px;">${length}</td>
        <td style="padding:4px;">${time}</td>
        <td style="padding:4px;">${remark}</td>
      </tr>`;
    });
    results += '</table>';
    resultsDiv.innerHTML = results;
  }, 10000); // 10 seconds delay
};
    </script>

    <!-- 4. Request Editor / Repeater -->
    <section id="repeater" class="mb-12">
      <h2 class="section-title text-2xl font-heading font-bold mb-6 gradient-text">üìù Request Editor / Repeater</h2>
      <div class="section-card">
        <form>
          <div class="mb-4">
            <label class="block text-light-gray mb-1" for="request-raw">Raw HTTP Request</label>
            <textarea id="request-raw" rows="6" class="w-full rounded-md p-2 code-editor" placeholder="GET / HTTP/1.1&#10;Host: example.com"></textarea>
          </div>
          <button type="button" class="bg-primary hover:bg-orange-600 text-white py-2 px-6 rounded-md font-medium mb-4">Send</button>
          <div>
            <label class="block text-light-gray mb-1" for="response-raw">Raw HTTP Response</label>
            <textarea id="response-raw" rows="6" class="w-full rounded-md p-2 code-editor" readonly placeholder="HTTP/1.1 200 OK&#10;..."></textarea>
          </div>
        </form>
      </div>
    </section>

    <!-- 5. Intruder -->
    <section id="intruder" class="mb-12">
      <h2 class="section-title text-2xl font-heading font-bold mb-6 gradient-text">üéØ Intruder (Fuzzer)</h2>
      <div class="section-card">
        <form>
          <div class="mb-4">
            <label class="block text-light-gray mb-1" for="intruder-request">Request Template</label>
            <textarea id="intruder-request" rows="4" class="w-full rounded-md p-2 code-editor" placeholder="POST /login HTTP/1.1&#10;Host: example.com&#10;username=¬ßuser¬ß&amp;password=¬ßpass¬ß"></textarea>
          </div>
          <div class="mb-4">
            <label class="block text-light-gray mb-1" for="payloads">Payload List</label>
            <textarea id="payloads" rows="2" class="w-full rounded-md p-2" placeholder="admin&#10;test&#10;root"></textarea>
          </div>
          <button type="button" class="bg-primary hover:bg-orange-600 text-white py-2 px-6 rounded-md font-medium">Start Fuzzing</button>
        </form>
      </div>
    </section>

    <!-- 6. Scanner Reports -->
    <section id="reports" class="mb-12">
      <h2 class="section-title text-2xl font-heading font-bold mb-6 gradient-text">üìä Vulnerability Dashboard</h2>
      <div class="grid md:grid-cols-3 gap-8 mb-6">
        <div class="section-card text-center">
          <h3 class="text-primary font-bold mb-2">High</h3>
          <p class="text-3xl font-bold status-high">2</p>
        </div>
        <div class="section-card text-center">
          <h3 class="text-primary font-bold mb-2">Medium</h3>
          <p class="text-3xl font-bold status-medium">5</p>
        </div>
        <div class="section-card text-center">
          <h3 class="text-primary font-bold mb-2">Low</h3>
          <p class="text-3xl font-bold status-low">8</p>
        </div>
      </div>
      <div class="section-card overflow-x-auto">
        <table class="section-table">
          <thead>
            <tr>
              <th>Vulnerability</th>
              <th>Severity</th>
              <th>URL/Param</th>
              <th>CVE/CWE</th>
              <th>PoC</th>
              <th>Recommendation</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>XSS</td>
              <td class="status-high">High</td>
              <td>/search?q=</td>
              <td>CWE-79</td>
              <td><button class="bg-primary hover:bg-orange-600 text-white py-1 px-3 rounded">View</button></td>
              <td>Sanitize user input</td>
            </tr>
            <tr>
              <td>Server Header Leak</td>
              <td class="status-low">Low</td>
              <td>/</td>
              <td>CWE-200</td>
              <td><button class="bg-primary hover:bg-orange-600 text-white py-1 px-3 rounded">View</button></td>
              <td>Remove version headers</td>
            </tr>
          </tbody>
        </table>
        <div class="flex gap-4 mt-4">
          <button type="button" class="bg-primary hover:bg-orange-600 text-white py-2 px-6 rounded-md font-medium">Export PDF</button>
          <button type="button" class="bg-primary hover:bg-orange-600 text-white py-2 px-6 rounded-md font-medium">Export JSON</button>
        </div>
      </div>
    </section>

    <!-- 7. Logging & History -->
    <section id="logs" class="mb-12">
      <h2 class="section-title text-2xl font-heading font-bold mb-6 gradient-text">üßæ Logs & History</h2>
      <div class="section-card">
        <div class="mb-4">
          <label class="block text-light-gray mb-1">Filter:</label>
          <select class="w-48 rounded-md p-2">
            <option>All</option>
            <option>GET</option>
            <option>POST</option>
            <option>Status 200</option>
            <option>Status 4xx/5xx</option>
          </select>
        </div>
        <div class="overflow-x-auto">
          <table class="section-table">
            <thead>
              <tr>
                <th>Time</th>
                <th>Method</th>
                <th>URL</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>12:01:23</td>
                <td>GET</td>
                <td>/dashboard</td>
                <td class="status-low">200</td>
              </tr>
              <tr>
                <td>12:01:25</td>
                <td>POST</td>
                <td>/login</td>
                <td class="status-medium">302</td>
              </tr>
            </tbody>
          </table>
        </div>
        <button type="button" class="bg-primary hover:bg-orange-600 text-white py-2 px-6 rounded-md font-medium mt-4">Export Logs</button>
      </div>
    </section>

    <!-- 8. Authentication Handling -->
    <section id="settings" class="mb-12">
      <h2 class="section-title text-2xl font-heading font-bold mb-6 gradient-text">üîê Authentication Handling</h2>
      <div class="section-card">
        <form>
          <div class="mb-4">
            <label class="block text-light-gray mb-1" for="auth-type">Auth Type</label>
            <select id="auth-type" class="w-full rounded-md p-2">
              <option>None</option>
              <option>Basic</option>
              <option>Bearer Token</option>
              <option>Cookie</option>
            </select>
          </div>
          <div class="mb-4">
            <label class="block text-light-gray mb-1" for="auth-credentials">Credentials / Token / Cookie</label>
            <input id="auth-credentials" type="text" class="w-full rounded-md p-2" placeholder="Enter value here">
          </div>
          <button type="button" class="bg-primary hover:bg-orange-600 text-white py-2 px-6 rounded-md font-medium">Save Auth</button>
        </form>
      </div>
    </section>

    <!-- 9. Custom Payloads -->
    <section id="payloads" class="mb-12">
      <h2 class="section-title text-2xl font-heading font-bold mb-6 gradient-text">üß¨ Custom Payloads</h2>
      <div class="section-card">
        <form>
          <div class="mb-4">
            <label class="block text-light-gray mb-1" for="payload-type">Vulnerability Type</label>
            <select id="payload-type" class="w-full rounded-md p-2">
              <option>XSS</option>
              <option>SQLi</option>
              <option>SSRF</option>
              <option>Command Injection</option>
            </select>
          </div>
          <div class="mb-4">
            <label class="block text-light-gray mb-1" for="custom-payloads">Payloads</label>
            <textarea id="custom-payloads" rows="3" class="w-full rounded-md p-2" placeholder="Enter one payload per line"></textarea>
          </div>
          <div class="flex gap-4">
            <button type="button" class="bg-primary hover:bg-orange-600 text-white py-2 px-6 rounded-md font-medium">Save Payloads</button>
            <button type="button" class="bg-secondary border border-primary text-primary py-2 px-6 rounded-md font-medium">Update from GitHub</button>
          </div>
        </form>
      </div>
    </section>

    <!-- 10. Configurable Scan Settings -->
    <section id="scan-settings" class="mb-12">
      <h2 class="section-title text-2xl font-heading font-bold mb-6 gradient-text">‚öôÔ∏è Scan Settings</h2>
      <div class="section-card">
        <form>
          <div class="mb-4">
            <label class="block text-light-gray mb-1" for="scan-depth">Scan Depth</label>
            <input id="scan-depth" type="number" min="1" max="10" value="3" class="w-32 rounded-md p-2">
          </div>
          <div class="mb-4">
            <label class="block text-light-gray mb-1" for="scan-delay">Delay Between Requests (ms)</label>
            <input id="scan-delay" type="number" min="0" value="500" class="w-32 rounded-md p-2">
          </div>
          <div class="mb-4">
            <label class="block text-light-gray mb-1" for="user-agent">User Agent</label>
            <input id="user-agent" type="text" value="Intruscan/1.0" class="w-full rounded-md p-2">
          </div>
          <div class="mb-4 flex gap-6">
            <label class="inline-flex items-center">
              <input type="checkbox" checked class="accent-primary mr-2"> Enable Active Scan
            </label>
            <label class="inline-flex items-center">
              <input type="checkbox" checked class="accent-primary mr-2"> Enable Passive Scan
            </label>
          </div>
          <button type="button" class="bg-primary hover:bg-orange-600 text-white py-2 px-6 rounded-md font-medium">Save Settings</button>
        </form>
      </div>
    </section>

    <!-- Sleek Responsive Features Grid for Intruscan with Icons and Table Example -->
    <section id="features" class="container mx-auto px-4 py-20">
      <h2 class="text-4xl md:text-5xl font-heading font-bold text-center mb-14 gradient-text">
        Intruscan Features
      </h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
        <!-- Scope Manager -->
        <div class="bg-[#232323] rounded-2xl border-l-4 border-primary p-6 shadow-lg card-hover flex flex-col h-full">
          <div class="flex items-center mb-3">
            <i class="bi bi-bullseye text-primary text-3xl mr-3"></i>
            <span class="font-bold text-lg text-white">Scope Manager</span>
          </div>
          <p class="text-gray-400 text-sm mb-2">Define exactly what to scan. Include/exclude domains and URLs for precise targeting.</p>
          <table class="w-full text-xs mt-2 border border-[#333] rounded">
            <thead>
              <tr class="bg-[#191919] text-primary">
                <th class="p-1 border border-[#333]">Include</th>
                <th class="p-1 border border-[#333]">Exclude</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="p-1 border border-[#333]">example.com</td>
                <td class="p-1 border border-[#333]">example.com/logout</td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- Site Map -->
        <div class="bg-[#232323] rounded-2xl border-l-4 border-primary p-6 shadow-lg card-hover flex flex-col h-full">
          <div class="flex items-center mb-3">
            <i class="bi bi-diagram-3 text-primary text-3xl mr-3"></i>
            <span class="font-bold text-lg text-white">Site Map</span>
          </div>
          <p class="text-gray-400 text-sm mb-2">Visual map of all discovered endpoints, methods, and status codes.</p>
          <table class="w-full text-xs mt-2 border border-[#333] rounded">
            <thead>
              <tr class="bg-[#191919] text-primary">
                <th class="p-1 border border-[#333]">URL</th>
                <th class="p-1 border border-[#333]">Method</th>
                <th class="p-1 border border-[#333]">Status</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="p-1 border border-[#333]">/login</td>
                <td class="p-1 border border-[#333]">POST</td>
                <td class="p-1 border border-[#333] text-yellow-400">302</td>
              </tr>
              <tr>
                <td class="p-1 border border-[#333]">/dashboard</td>
                <td class="p-1 border border-[#333]">GET</td>
                <td class="p-1 border border-[#333] text-green-400">200</td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- Automated Crawler -->
        <div class="bg-[#232323] rounded-2xl border-l-4 border-primary p-6 shadow-lg card-hover flex flex-col h-full">
          <div class="flex items-center mb-3">
            <i class="bi bi-search text-primary text-3xl mr-3"></i>
            <span class="font-bold text-lg text-white">Automated Crawler</span>
          </div>
          <p class="text-gray-400 text-sm mb-2">Crawls static & dynamic links, parses forms, parameters, and cookies.</p>
        </div>
        <!-- Passive & Active Scanner -->
        <div class="bg-[#232323] rounded-2xl border-l-4 border-primary p-6 shadow-lg card-hover flex flex-col h-full">
          <div class="flex items-center mb-3">
            <i class="bi bi-shield-check text-primary text-3xl mr-3"></i>
            <span class="font-bold text-lg text-white">Passive & Active Scanner</span>
          </div>
          <ul class="list-disc pl-6 text-gray-400 text-sm mb-2">
            <li>Detects XSS, SQLi, SSRF, Command Injection, Open Redirects, File Inclusion</li>
            <li>Finds server leaks, insecure cookies, version disclosures</li>
          </ul>
        </div>
        <!-- Request Repeater -->
        <div class="bg-[#232323] rounded-2xl border-l-4 border-primary p-6 shadow-lg card-hover flex flex-col h-full">
          <div class="flex items-center mb-3">
            <i class="bi bi-terminal text-primary text-3xl mr-3"></i>
            <span class="font-bold text-lg text-white">Request Repeater</span>
          </div>
          <p class="text-gray-400 text-sm">Manually craft, modify, and resend HTTP requests for advanced debugging and testing.</p>
        </div>
        <!-- Intruder (Fuzzer) -->
        <div class="bg-[#232323] rounded-2xl border-l-4 border-primary p-6 shadow-lg card-hover flex flex-col h-full">
          <div class="flex items-center mb-3">
            <i class="bi bi-lightning-charge text-primary text-3xl mr-3"></i>
            <span class="font-bold text-lg text-white">Intruder (Fuzzer)</span>
          </div>
          <p class="text-gray-400 text-sm">Fuzz endpoints with custom payloads and automate attack simulations.</p>
        </div>
        <!-- Vulnerability Dashboard -->
        <div class="bg-[#232323] rounded-2xl border-l-4 border-primary p-6 shadow-lg card-hover flex flex-col h-full">
          <div class="flex items-center mb-3">
            <i class="bi bi-bar-chart text-primary text-3xl mr-3"></i>
            <span class="font-bold text-lg text-white">Vulnerability Dashboard</span>
          </div>
          <p class="text-gray-400 text-sm mb-2">Severity-wise summary, CVE/CWE reference, PoC, fix recommendations, and exportable reports.</p>
          <table class="w-full text-xs mt-2 border border-[#333] rounded">
            <thead>
              <tr class="bg-[#191919] text-primary">
                <th class="p-1 border border-[#333]">Vulnerability</th>
                <th class="p-1 border border-[#333]">Severity</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="p-1 border border-[#333]">XSS</td>
                <td class="p-1 border border-[#333] text-red-400">High</td>
              </tr>
              <tr>
                <td class="p-1 border border-[#333]">Server Header Leak</td>
                <td class="p-1 border border-[#333] text-green-400">Low</td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- Logs & History -->
        <div class="bg-[#232323] rounded-2xl border-l-4 border-primary p-6 shadow-lg card-hover flex flex-col h-full">
          <div class="flex items-center mb-3">
            <i class="bi bi-clock-history text-primary text-3xl mr-3"></i>
            <span class="font-bold text-lg text-white">Logs & History</span>
          </div>
          <p class="text-gray-400 text-sm">Track all HTTP requests/responses and filter or export logs as needed.</p>
        </div>
        <!-- Authentication Handling -->
        <div class="bg-[#232323] rounded-2xl border-l-4 border-primary p-6 shadow-lg card-hover flex flex-col h-full">
          <div class="flex items-center mb-3">
            <i class="bi bi-unlock text-primary text-3xl mr-3"></i>
            <span class="font-bold text-lg text-white">Authentication Handling</span>
          </div>
          <p class="text-gray-400 text-sm">Input credentials, tokens, or cookies to scan authenticated areas securely.</p>
        </div>
        <!-- Custom Payloads -->
        <div class="bg-[#232323] rounded-2xl border-l-4 border-primary p-6 shadow-lg card-hover flex flex-col h-full">
          <div class="flex items-center mb-3">
            <i class="bi bi-list-stars text-primary text-3xl mr-3"></i>
            <span class="font-bold text-lg text-white">Custom Payloads</span>
          </div>
          <p class="text-gray-400 text-sm">Define and manage your own payload sets for targeted vulnerability testing.</p>
        </div>
        <!-- Configurable Scan Settings -->
        <div class="bg-[#232323] rounded-2xl border-l-4 border-primary p-6 shadow-lg card-hover flex flex-col h-full">
          <div class="flex items-center mb-3">
            <i class="bi bi-sliders text-primary text-3xl mr-3"></i>
            <span class="font-bold text-lg text-white">Configurable Scan Settings</span>
          </div>
          <p class="text-gray-400 text-sm">Set scan depth, delays, user agents, and toggle scan modes for full control.</p>
        </div>
      </div>
    </section>

    <!-- Temporary Site Map Entry Form for Testing -->
    <div class="section-card mb-8">
      <h3 class="text-lg font-bold mb-2 text-primary">Add Site Map Entry (Test Only)</h3>
      <form id="sitemap-test-form" class="flex flex-wrap gap-4 items-end">
        <div>
          <label class="block text-light-gray mb-1" for="test-url">URL</label>
          <input id="test-url" type="text" class="rounded-md p-2" placeholder="/login" required>
        </div>
        <div>
          <label class="block text-light-gray mb-1" for="test-method">Method</label>
          <select id="test-method" class="rounded-md p-2">
            <option>GET</option>
            <option>POST</option>
            <option>PUT</option>
            <option>DELETE</option>
          </select>
        </div>
        <div>
          <label class="block text-light-gray mb-1" for="test-status">Status</label>
          <input id="test-status" type="number" class="rounded-md p-2" placeholder="200" required>
        </div>
        <button type="submit" class="bg-primary hover:bg-orange-600 text-white py-2 px-6 rounded-md font-medium">Add</button>
      </form>
    </div>

    <script>
    document.getElementById('sitemap-test-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      const url = document.getElementById('test-url').value.trim();
      const method = document.getElementById('test-method').value;
      const status = parseInt(document.getElementById('test-status').value, 10);
      if (url && method && status) {
        await fetch('http://localhost:4000/api/sitemap/add', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ url, method, status })
        });
        // Optionally refresh the site map table if you have that function
        if (typeof fetchSiteMap === 'function') fetchSiteMap();
        // Clear form
        document.getElementById('sitemap-test-form').reset();
      }
    });
    </script>

    <!-- Scan Button -->
<button id="scan-btn" class="bg-primary hover:bg-orange-600 text-white py-2 px-6 rounded-md font-medium mb-4">
  Scan for OWASP Top 10
</button>
<div id="scan-results"></div>

<script>
document.getElementById('scan-btn').addEventListener('click', async function() {
  document.getElementById('scan-results').innerHTML = 'Scanning...';
  const res = await fetch('/api/scan', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ startUrl })
  });
  const data = await res.json();
  if (!data.results || data.results.length === 0) {
    document.getElementById('scan-results').innerHTML = 'No vulnerabilities found.';
  } else {
    document.getElementById('scan-results').innerHTML = `
      <table class="w-full">
        <thead><tr><th>URL</th><th>Type</th><th>Payload</th></tr></thead>
        <tbody>
          ${data.results.map(r => `<tr><td>${r.url}</td><td>${r.type}</td><td>${r.payload}</td></tr>`).join('')}
        </tbody>
      </table>
    `;
  }
});
</script>
  </main>
</body>
</html>
